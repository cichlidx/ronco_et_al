#!/bin/bash

#SBATCH --job-name=MultipleAlignment_of_Coding_SEquences
#SBATCH --mail-user=athimed.eltaher@unibas.ch
#SBATCH --mail-type=FAIL,REQUEUE,ARRAY_TASKS
#SBATCH --cpus-per-task=1
#SBATCH --mem-per-cpu=10G
#SBATCH --qos=1day
#SBATCH --time=1-00:00:00
#SBATCH --array=2358,2252,2243,2348,2326,2323,2311,2219,2297,2253,2207,2211,2217,2212,2192,2185,2161,2148,2139,2117,2120,2113,2105,2097,2084,2082,2075,2065,2071,2072,2044,2003,2295,1974,1973,1968,1964,1948,1924,1918,1897,1893,1889,1871,1869,1850,1842,1841,1804,1801,1795,1778,1776,1772,1766,1759,1761,1754,1749,1741,1738,1728,1723,1721,1722,1715,1713,1702,1689,1664,1641,1608,1614,1609,1632,1628,1887,1605,1586,1578,1550,1563,1543,1514,1507,1533,1513,1530,1506,1505,1493,1450,1471,1488,1484,1468,1432,1440,1445,1431,1430,1512,1409,1407,1386,1390,1385,1384,1371,1369,1356,1346,1345,1343,1340,1337,1323,1308,1287,1292,1280,1262,1250,1248,1221,1215,1203,1200,1199,1195,1191,1179,1171,1158,1142,1144,1135,1134,1129,1122,1119,1114,1111,1109,1084,1070,1048,1041,1046,1019,1009,1020,990,989,986,966,955,930,922,907,901,896,888,872,883,871,882,859,862,854,836,818,813,800,794,784,785,772,754,824,709,694,687,701,677,656,657,644,641,646,634,629,615,892,595,587,573,569,557,558,552,538,533,518,516,501,489,495,482,476,468,425,433,434,417,403,394,395,398,397,384,368,358,352,351,350,345,341,338,327,322,321,317,316,309,301,243,236,237,225,216,212,207,203,199,165,150,148,140,137,127,115,81,77,38,45,3,4529,4514,4515,4500,4473,4466,4435,4417,4402,4401,4393,4380,4376,4361,4330,4325,4315,4308,4305,4294,4290,4286,4279,4258,4255,4238,4236,4230,4228,4225,4220,4215,4212,4211,4210,4209,4207,4203,4201,4189,4188,4183,4163,4148,4147,4143,4135,4114,4110,4106,4101,4098,4097,4095,4084,4081,4079,4072,4070,4056,4045,4022,4017,4011,4009,4008,3995,3989,3984,3982,3979,3978,3969,3967,3964,3957,3953,3950,3944,3941,3939,3937,3932,3922,3917,3909,3875,3863,3858,3853,3848,3841,3840,3839,3829,3820,3813,3804,3793,3786,3775,3759,3756,3749,3743,3740,3735,3727,3722,3716,3714,3713,3707,3704,3694,3687,3677,3670,3646,3641,3630,3628,3618,3617,3607,3606,3605,3600,3597,3581,3575,3572,3569,3564,3559,3553,3551,3539,3541,3525,3516,3513,3505,3496,3481,3443,3440,3625,3428,3418,3413,3402,3378,3376,3375,3372,3371,3369,3366,3347,3326,3327,3319,3320,3315,3312,3302,3292,3262,3264,3260,3253,3235,3233,3232,3229,3224,3212,3197,3506,3185,3164,3156,3353,3141,3420,3121,3117,3112,3110,3102,3098,3096,3077,3058,3059,3055,3045,3040,3026,3019,3013,2999,2990,2989,2979,2980,2974,2969,2951,2940,2915,2911,2910,2891,2890,2867,2864,2855,2830,2832,2822,2805,2795,2787,2776,2764,2757,2756,2751,2744,2737,2731,2723,2721,2715,2709,2701,2699,2680,2656,2655,2653,2643,2633,2621,2629,2635,2608,2903,2605,2603,2596,2590,2585,2584,2580,2570,2568,2565,2561,2556,2553,2532,2512,2510,2503,2494,2490,2479,2476,2470,2467,2441,2439,2436,2429,2414,2422,2398,2371,2362,2363,2353,2319,2310,2292,2286,6320,6038,6039,6031,6026,6018,5994,5990,5976,5968,5953,5947,5942,5938,5936,5932,5929,5928,5911,5906,5903,5895,5866,5861,5858,5856,5851,5838,5833,5832,5825,5812,5808,5805,5799,5785,5775,5768,5748,5743,5721,5709,5704,5701,5686,5673,5671,5670,5669,5667,5663,5661,5647,5645,5643,5630,5626,5624,5621,5607,5606,5884,5595,5592,5591,5584,5582,5576,5572,5568,5839,5562,5545,5541,5538,5536,5535,5488,5479,5478,5477,5463,5462,5457,5450,5442,5422,5421,5419,5408,5403,5384,5379,5374,5372,5368,5350,5340,5334,5329,5319,5308,5307,5261,5260,5248,5245,5243,5239,5226,5215,5202,5196,5193,5191,5179,5163,5158,5131,5128,5126,5122,5116,5115,5103,5100,5098,5060,5058,5040,5032,5027,5028,5023,5011,4993,4984,4981,5235,4969,4959,4936,4933,4926,4919,4907,4889,4882,5167,4871,4868,4858,4857,4854,4850,4840,4827,4821,4810,4804,4796,4776,4775,4759,4756,4739,4738,4732,4722,4701,4696,4665,4662,4651,4645,4635,4630,4625,4624,4622,4621,4617,4613,4608,4600,4587,4582,4578,4567,4565,4561,4539
#SBATCH --output=/scicore/home/salzburg/eltaher/cichlidX/scicore_report/MultipleAlignment_of_Coding_SEquences_out.o
#SBATCH --error=/scicore/home/salzburg/eltaher/cichlidX/scicore_report/MultipleAlignment_of_Coding_SEquences_err.o
#SBATCH --workdir=/scicore/home/salzburg/eltaher/cichlidX/script/macse

module load R/3.5.0-goolf-1.7.20
module load SAMtools/1.7-goolf-1.7.20


export SEQUENCE=`cut -f 3 /scicore/home/salzburg/eltaher/cichlidX/result/Augustus_codingseq_PlacedOnTilpiaCDS/TilapiaRepresentativeProteins_positiveSelection_0.8per_490Genomes_15291UniqueProteins_2018-10-05.txt | tail -n +2 | head -n $SLURM_ARRAY_TASK_ID | tail -n 1`

export ID=`grep ${SEQUENCE} /scicore/home/salzburg/eltaher/cichlidX/result/Augustus_codingseq_PlacedOnTilpiaCDS/GCF_001858045.1_ASM185804v2_reconstructed_Full_sequences_seqCDS_0.8per_490Genomes_reversedSequences_2018-10-05.fna  | sed 's/>//g'`
export ID2=`echo $ID | sed 's/|.*//g'`
samtools faidx /scicore/home/salzburg/eltaher/cichlidX/result/Augustus_codingseq_PlacedOnTilpiaCDS/GCF_001858045.1_ASM185804v2_reconstructed_Full_sequences_seqCDS_0.8per_490Genomes_reversedSequences_2018-10-05.fna $ID > /scicore/home/salzburg/eltaher/cichlidX/result/macse/${ID2}.fasta

for specimen in `cat /scicore/home/salzburg/eltaher/cichlidX/data/dNdS_genomes/speciesList.txt`
do
export ID=`grep ${SEQUENCE} /scicore/home/salzburg/eltaher/cichlidX/result/Augustus_codingseq_PlacedOnTilpiaCDS/${specimen}_reconstructed_sequences_seqCDS_0.8per_15291Genomes_2018-10-05.fna | sed 's/>//g'`
export ID2=`echo $ID | sed 's/|.*//g'`
samtools faidx /scicore/home/salzburg/eltaher/cichlidX/result/Augustus_codingseq_PlacedOnTilpiaCDS/${specimen}_reconstructed_sequences_seqCDS_0.8per_15291Genomes_2018-10-05.fna $ID >> /scicore/home/salzburg/eltaher/cichlidX/result/macse/${ID2}.fasta
done

java -jar /scicore/home/salzburg/eltaher/cichlidX/script/macse/macse_v2.01.jar -prog alignSequences -seq /scicore/home/salzburg/eltaher/cichlidX/result/macse/${ID2}.fasta -gap_op -7 -gap_ext -1 -fs -30 -gc_def 1 -stop -100 -out_AA /scicore/home/salzburg/eltaher/cichlidX/result/macse/${ID2}.macse.aa.fasta -out_NT /scicore/home/salzburg/eltaher/cichlidX/result/macse/${ID2}.macse.nucl.fasta
